<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PyScript CLI-Style Chatbot</title>
<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
<script defer src="https://pyscript.net/releases/2023.11.1/pyscript.js"></script>
<link rel="stylesheet" href="https://pyscript.net/releases/2023.11.1/pyscript.css" />
<style>
    body {
        font-family: monospace, monospace;
        max-width: 700px;
        margin: auto;
        padding: 1rem;
        background: black;
        color: #33ff33;
    }
    #output {
        background: black;
        color: #33ff33;
        height: 400px;
        overflow-y: scroll;
        padding: 1rem;
        border: 2px solid #33ff33;
        white-space: pre-wrap;
    }
    #user-input {
        width: 100%;
        font-family: monospace;
        font-size: 1rem;
        background: black;
        color: #33ff33;
        border: 2px solid #33ff33;
        padding: 0.5rem;
    }
</style>
</head>
<body>

<h2>Python Chatbot (Command Line Style)</h2>
<div id="output"></div>
<input id="user-input" type="text" autocomplete="off" placeholder="Type your answer here" autofocus />

<py-script>
from js import document
from datetime import date
from collections import Counter

output = document.getElementById("output")
user_input = document.getElementById("user-input")

list_of_students_age = []
dictionary_colours = {}
days_of_week = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
days_in_a_month = {"January": 31, "February": 28}

current_step = 0
temp_name = ""
temp_age = None
temp_colour = ""
temp_shape_answer = ""

def CalculateAge(birthday):
    parts = birthday.split('/')
    if len(parts) != 3:
        return None
    try:
        day, month, year = int(parts[0]), int(parts[1]), int(parts[2])
    except:
        return None
    today = date.today()
    age = today.year - year
    if (today.month, today.day) < (month, day):
        age -= 1
    return age

def DrawDiamond():
    lines = []
    height = 4
    for i in range(height):
        lines.append(" " * (height - i) + "*" * (i * 2 + 1))
    for i in range(1, height):
        lines.append(" " * (i + 1) + "*" * (2 * height - i * 2 - 1))
    return "\n".join(lines)

def append_output(text):
    output.innerHTML += text + "\n"
    output.scrollTop = output.scrollHeight

def prompt(text):
    append_output(text)

def process_input(ans):
    global current_step, temp_name, temp_age, temp_colour, temp_shape_answer

    # Echo user input in terminal style
    append_output("> " + ans)

    if current_step == 0:  # ask name
        if len(ans) < 2 or len(ans) > 10:
            prompt("Haha nice try with the name! Let's enter the correct name")
            return
        temp_name = ans
        prompt(f"Welcome to Python {temp_name}!")
        prompt("Let's calculate your age from your date of birth!! What is your date of birth? Write in this format: DD/MM/YYYY")
        current_step = 1

    elif current_step == 1:  # ask birthday
        age = CalculateAge(ans)
        if age is None or age < 0 or age > 150:
            prompt("That doesn't seem like a valid date. Please enter DOB in DD/MM/YYYY format.")
            return
        temp_age = age
        list_of_students_age.append(age)
        prompt(f"Your age is {age}!")
        if age > 40:
            prompt("Oh wow! You are quite old!")
        prompt("Lets talk about colours! What colour is your favourite?")
        current_step = 2

    elif current_step == 2:  # ask favourite colour
        temp_colour = ans
        dictionary_colours[temp_name] = temp_colour
        prompt(f"{temp_colour} is an amazing colour!")
        prompt("Do you prefer rectangles or diamonds? Type the name of the shape that you prefer")
        current_step = 3

    elif current_step == 3:  # ask shape preference
        a = ans.lower()
        if a == "diamond":
            prompt(DrawDiamond())
            prompt("Is there anyone else who wants to answer these questions? (yes/no)")
            current_step = 4
        elif a == "rectangle":
            height = 5
            rect = "\n".join(["*" * height for _ in range(height)])
            prompt(rect)
            prompt("Is there anyone else who wants to answer these questions? (yes/no)")
            current_step = 4
        else:
            prompt("Oops! I can only make a rectangle or a diamond. Type the name of the shape that you would prefer")

    elif current_step == 4:  # ask if another student
        if ans.lower() == "yes":
            prompt("\nFirst Question! What is your name?")
            current_step = 0
        elif ans.lower() == "no":
            prompt("Do you want to know the oldest and youngest age in this class? (yes/no)")
            current_step = 5
        else:
            prompt("Please answer with yes or no.")

    elif current_step == 5:  # ask oldest youngest
        if ans.lower() == "yes":
            maximum_age = max(list_of_students_age)
            minimum_age = min(list_of_students_age)
            prompt("Let's see what was the maximum and minimum age in the class")
            prompt(f"The maximum age was {maximum_age}")
            prompt(f"The minimum age was {minimum_age}")
            days_of_week.append("Saturday")
            days_of_week.append("Sunday")
            days_in_a_month["March"] = 31
            prompt("Do you want me to make a bar chart of everyone's ages? (yes/no)")
            current_step = 6
        elif ans.lower() == "no":
            prompt("Alright let's move on!")
            days_of_week.append("Saturday")
            days_of_week.append("Sunday")
            days_in_a_month["March"] = 31
            prompt("Do you want me to make a bar chart of everyone's ages? (yes/no)")
            current_step = 6
        else:
            prompt("Please answer yes or no.")

    elif current_step == 6:  # bar chart question
        if ans.lower() == "yes":
            prompt("\nDrawing bar chart of ages... (Not implemented in this demo)\n")
            prompt("Okay that's it for us :( Thank you for chatting! See you next time!")
            current_step = 7
        elif ans.lower() == "no":
            prompt("Okay that's it for us :( Thank you for chatting! See you next time!")
            current_step = 7
        else:
            prompt("Please answer yes or no.")

    elif current_step == 7:
        # conversation ended
        prompt("The chat has ended. Refresh the page to start again.")
        user_input.disabled = True

# Start
prompt("Hello! I am a Python Chatbot and I am going to ask you some questions! (ﾉ◕ヮ◕)ﾉ*:・ﾟ✧\n")
prompt("First Question! What is your name?")

def on_enter(e):
    if e.key == "Enter":
        val = user_input.value.strip()
        if val != "":
            process_input(val)
            user_input.value = ""

user_input.addEventListener("keypress", on_enter)
</py-script>

</body>
</html>
